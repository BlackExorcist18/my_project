#!/usr/bin/env python3
"""–ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Quiz).

–ó–∞–ø—É—Å–∫: python run_tests.py
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ test_results.json
"""

import json
import os
import sys
import tempfile
import shutil
from datetime import datetime
from typing import Dict, Any, List

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))


class QuizTester:
    """–ö–ª–∞—Å—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."""
    
    def __init__(self):
        self.results = {
            "timestamp": datetime.now().isoformat(),
            "total_tests": 0,
            "passed": 0,
            "failed": 0,
            "tests": []
        }
        self.temp_dir = None
        
    def setup(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        print("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è...")
        self.temp_dir = tempfile.mkdtemp(prefix="quiz_test_")
        print(f"üìÅ –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞: {self.temp_dir}")
        
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        self.create_test_files()
        
    def teardown(self):
        """–û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        if self.temp_dir and os.path.exists(self.temp_dir):
            print(f"üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–∞–ø–∫–∏: {self.temp_dir}")
            shutil.rmtree(self.temp_dir)
    
    def create_test_files(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å —Ç–µ—Å—Ç–∞–º–∏."""
        test_data = [
            {
                "name": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö",
                "description": "–ü—Ä–æ—Å—Ç—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã",
                "questions": [
                    {
                        "question": "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?",
                        "options": ["3", "4", "5", "6"],
                        "correct_answer": 1
                    },
                    {
                        "question": "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 3 * 3?",
                        "options": ["6", "9", "12", "15"],
                        "correct_answer": 1
                    }
                ]
            },
            {
                "name": "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è",
                "description": "–û—Å–Ω–æ–≤—ã –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏",
                "questions": [
                    {
                        "question": "–°—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?",
                        "options": ["–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫"],
                        "correct_answer": 0
                    }
                ]
            }
        ]
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        tests_file = os.path.join(self.temp_dir, "tests.json")
        with open(tests_file, 'w', encoding='utf-8') as f:
            json.dump(test_data, f, ensure_ascii=False, indent=2)
        
        print(f"‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª: {tests_file}")
        return tests_file
    
    def run_test(self, test_name: str, test_func) -> Dict[str, Any]:
        """–ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞.
        
        Args:
            test_name: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞.
            test_func: –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∞.
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞.
        """
        print(f"\n{'='*60}")
        print(f"üß™ –¢–ï–°–¢: {test_name}")
        print(f"{'='*60}")
        
        test_result = {
            "name": test_name,
            "status": "PASSED",
            "error": None,
            "duration": None
        }
        
        start_time = datetime.now()
        
        try:
            test_func()
            test_result["status"] = "PASSED"
            print(f"‚úÖ {test_name}: –ü–†–û–ô–î–ï–ù")
            self.results["passed"] += 1
            
        except AssertionError as e:
            test_result["status"] = "FAILED"
            test_result["error"] = f"AssertionError: {str(e)}"
            print(f"‚ùå {test_name}: –ù–ï –ü–†–û–ô–î–ï–ù - {e}")
            self.results["failed"] += 1
            
        except Exception as e:
            test_result["status"] = "FAILED"
            test_result["error"] = f"Exception: {type(e).__name__}: {str(e)}"
            print(f"‚ùå {test_name}: –û–®–ò–ë–ö–ê - {type(e).__name__}: {e}")
            self.results["failed"] += 1
            
        finally:
            end_time = datetime.now()
            test_result["duration"] = (end_time - start_time).total_seconds()
            
        self.results["tests"].append(test_result)
        self.results["total_tests"] += 1
        
        return test_result
    
    def test_loader_module(self):
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è loader."""
        from nancy import loader
        
        tests_file = os.path.join(self.temp_dir, "tests.json")
        
        # –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞
        tests = loader.load_tests_from_file(tests_file)
        assert len(tests) == 2, f"–û–∂–∏–¥–∞–ª–æ—Å—å 2 —Ç–µ—Å—Ç–∞, –ø–æ–ª—É—á–µ–Ω–æ {len(tests)}"
        assert tests[0]["name"] == "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö"
        assert len(tests[0]["questions"]) == 2
        
        # –¢–µ—Å—Ç 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
        new_test = {
            "name": "–ù–æ–≤—ã–π —Ç–µ—Å—Ç",
            "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
            "questions": [{"question": "–í–æ–ø—Ä–æ—Å?", "options": ["–î–∞", "–ù–µ—Ç"], "correct_answer": 0}]
        }
        
        result = loader.save_test_to_file(new_test, tests_file)
        assert result is True, "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å"
        
        # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–µ—Å—Ç –¥–æ–±–∞–≤–∏–ª—Å—è
        tests = loader.load_tests_from_file(tests_file)
        assert len(tests) == 3, f"–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–∂–∏–¥–∞–ª–æ—Å—å 3 —Ç–µ—Å—Ç–∞, –ø–æ–ª—É—á–µ–Ω–æ {len(tests)}"
        
        print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –º–æ–¥—É–ª—è loader –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ")
    
    def test_engine_module(self):
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è engine."""
        from nancy import loader, engine
        
        tests_file = os.path.join(self.temp_dir, "tests.json")
        tests = loader.load_tests_from_file(tests_file)
        
        # –°–æ–∑–¥–∞–µ–º –¥–≤–∏–∂–æ–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        quiz = engine.QuizEngine(tests)
        
        # –¢–µ—Å—Ç 1: –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤
        test_list = quiz.list_tests()
        assert len(test_list) == 2, f"–û–∂–∏–¥–∞–ª–æ—Å—å 2 —Ç–µ—Å—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–ª—É—á–µ–Ω–æ {len(test_list)}"
        assert "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö" in test_list
        
        # –¢–µ—Å—Ç 2: –í—ã–±–æ—Ä —Ç–µ—Å—Ç–∞
        selected = quiz.select_test("–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö")
        assert selected is True, "–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–±—Ä–∞—Ç—å —Ç–µ—Å—Ç"
        
        # –¢–µ—Å—Ç 3: –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        quiz.start_quiz(shuffle=False)
        assert quiz.total_questions == 2, f"–û–∂–∏–¥–∞–ª–æ—Å—å 2 –≤–æ–ø—Ä–æ—Å–∞, –ø–æ–ª—É—á–µ–Ω–æ {quiz.total_questions}"
        
        # –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤
        question1 = quiz.get_next_question()
        assert question1 is not None, "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å"
        
        question_text, options, correct_answer = question1
        assert question_text == "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?"
        assert len(options) == 4
        assert correct_answer == 1
        
        # –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
        is_correct = quiz.check_answer(1, 1)  # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        assert is_correct is True, "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å True"
        assert quiz.score == 1, f"–û–∂–∏–¥–∞–ª—Å—è —Å—á–µ—Ç 1, –ø–æ–ª—É—á–µ–Ω–æ {quiz.score}"
        
        is_correct = quiz.check_answer(0, 1)  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        assert is_correct is False, "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å False"
        
        print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –º–æ–¥—É–ª—è engine –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ")
    
    def test_results_module(self):
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è results."""
        from nancy import results
        
        # –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        test_results = {
            "test_name": "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ—Å—Ç",
            "score": 8,
            "total_questions": 10,
            "percentage": 80.0,
            "passed": True
        }
        
        # –¢–µ—Å—Ç 1: –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫)
        try:
            results.show_results(test_results)
            print("‚úÖ show_results –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫")
        except Exception as e:
            raise AssertionError(f"show_results –≤—ã–∑–≤–∞–ª –æ—à–∏–±–∫—É: {e}")
        
        # –¢–µ—Å—Ç 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª
        results_file = os.path.join(self.temp_dir, "results.json")
        save_result = results.save_results_to_file(test_results, results_file)
        assert save_result is True, "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ —É–¥–∞–ª–æ—Å—å"
        
        # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
        assert os.path.exists(results_file), "–§–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ —Å–æ–∑–¥–∞–Ω"
        
        # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
        with open(results_file, 'r', encoding='utf-8') as f:
            saved_data = json.load(f)
        
        assert len(saved_data) == 1, "–í —Ñ–∞–π–ª–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1 —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
        assert saved_data[0]["test_name"] == "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ—Å—Ç"
        assert saved_data[0]["score"] == 8
        
        print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –º–æ–¥—É–ª—è results –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ")
    
    def test_argparse_commands(self):
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏."""
        from nancy import commands
        import argparse
        
        # –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞
        parser = commands.setup_parser()
        assert isinstance(parser, argparse.ArgumentParser)
        
        # –¢–µ—Å—Ç 2: –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã list
        args = parser.parse_args(["list"])
        assert args.command == "list"
        
        # –¢–µ—Å—Ç 3: –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã run —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
        args = parser.parse_args(["run", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "--questions", "5", "--no-shuffle"])
        assert args.command == "run"
        assert args.run_test == "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
        assert args.questions == 5
        assert args.no_shuffle is True
        
        print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã argparse –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ")
    
    def test_integration(self):
        """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã."""
        from nancy import loader, engine, results
        
        tests_file = os.path.join(self.temp_dir, "tests.json")
        
        # 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Å—Ç—ã
        tests = loader.load_tests_from_file(tests_file)
        
        # 2. –°–æ–∑–¥–∞–µ–º –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–≤–∏–∂–æ–∫
        quiz = engine.QuizEngine(tests)
        quiz.select_test("–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö")
        quiz.start_quiz(shuffle=False)
        
        # 3. –ü—Ä–æ—Ö–æ–¥–∏–º –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
        total_questions = 0
        correct_answers = 0
        
        while True:
            question_data = quiz.get_next_question()
            if question_data is None:
                break
            
            question_text, options, correct_answer = question_data
            total_questions += 1
            
            # –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
            is_correct = quiz.check_answer(correct_answer, correct_answer)
            if is_correct:
                correct_answers += 1
        
        # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        assert total_questions == 2, f"–û–∂–∏–¥–∞–ª–æ—Å—å 2 –≤–æ–ø—Ä–æ—Å–∞, –ø—Ä–æ–π–¥–µ–Ω–æ {total_questions}"
        assert correct_answers == 2, f"–û–∂–∏–¥–∞–ª–æ—Å—å 2 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–æ {correct_answers}"
        assert quiz.score == 2, f"–û–∂–∏–¥–∞–ª—Å—è —Å—á–µ—Ç 2, –ø–æ–ª—É—á–µ–Ω–æ {quiz.score}"
        
        # 5. –ü–æ–ª—É—á–∞–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        quiz_results = quiz.get_results()
        assert quiz_results["test_name"] == "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö"
        assert quiz_results["score"] == 2
        assert quiz_results["percentage"] == 100.0
        assert quiz_results["passed"] is True
        
        # 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
        results_file = os.path.join(self.temp_dir, "integration_results.json")
        results.save_results_to_file(quiz_results, results_file)
        
        print("‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ")
    
    def save_results(self, filename: str = "test_results.json"):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ JSON —Ñ–∞–π–ª.
        
        Args:
            filename: –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
        """
        # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        self.results["success_rate"] = (self.results["passed"] / self.results["total_tests"] * 100) if self.results["total_tests"] > 0 else 0
        
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(self.results, f, ensure_ascii=False, indent=2)
        
        print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {filename}")
        
        # –í—ã–≤–æ–¥–∏–º —Å–≤–æ–¥–∫—É
        print("\n" + "="*60)
        print("üìà –°–í–û–î–ö–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
        print("="*60)
        print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {self.results['total_tests']}")
        print(f"–ü—Ä–æ–π–¥–µ–Ω–æ: {self.results['passed']} ‚úÖ")
        print(f"–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ: {self.results['failed']} ‚ùå")
        print(f"–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: {self.results['success_rate']:.1f}%")
        
        if self.results['failed'] > 0:
            print("\n‚ùå –ù–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã:")
            for test in self.results['tests']:
                if test['status'] == 'FAILED':
                    print(f"  - {test['name']}: {test['error']}")
    
    def run_all_tests(self):
        """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤."""
        print("üöÄ –ó–ê–ü–£–°–ö –ê–í–¢–û–¢–ï–°–¢–û–í –°–ò–°–¢–ï–ú–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
        print("="*60)
        
        self.setup()
        
        try:
            # –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã
            self.run_test("–ú–æ–¥—É–ª—å loader", self.test_loader_module)
            self.run_test("–ú–æ–¥—É–ª—å engine", self.test_engine_module)
            self.run_test("–ú–æ–¥—É–ª—å results", self.test_results_module)
            self.run_test("–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏", self.test_argparse_commands)
            self.run_test("–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç", self.test_integration)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            self.save_results()
            
        finally:
            self.teardown()


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤."""
    tester = QuizTester()
    
    try:
        tester.run_all_tests()
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        if tester.results["failed"] == 0:
            print("\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!")
            sys.exit(0)
        else:
            print(f"\n‚ö†Ô∏è  –ü–†–û–ô–î–ï–ù–û {tester.results['passed']}/{tester.results['total_tests']} —Ç–µ—Å—Ç–æ–≤")
            sys.exit(1)
            
    except KeyboardInterrupt:
        print("\n\n‚èπÔ∏è  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        sys.exit(130)
    except Exception as e:
        print(f"\nüí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        sys.exit(1)
\

if __name__ == "__main__":
    main()